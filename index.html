<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸš€ Demo Stock Sales Tracker</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
  <link rel="manifest" href="manifest.json">
  <meta name="theme-color" content="#007bff" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    body { font-family: sans-serif; margin: 0; padding: 0; background: #f9f9f9; color: #333; }
    header { background: #343a40; color: #fff; padding: 1rem; text-align: center; }
    header img { max-height: 50px; vertical-align: middle; }
    header h1 { display: inline; margin-left: 1rem; font-size: 1.5rem; vertical-align: middle; }
    .form-container, .filter-container, .responsive-table-wrapper, .recycle-bin-container { padding: 1rem; max-width: 1000px; margin: auto; }
    form label { display: block; margin: 0.5rem 0; }
    form input { width: 100%; padding: 0.5rem; }
    .submit-btn, .download-btn, .clear-btn, .restore-btn, .delete-btn { margin: 0.5rem 0.25rem; padding: 0.5rem 1rem; cursor: pointer; }
    .total-sales { margin-top: 1rem; font-weight: bold; }
    table { width: 100%; border-collapse: collapse; margin-top: 1rem; background: white; }
    th, td { border: 1px solid #ddd; padding: 0.5rem; text-align: left; }
    th { background: #007bff; color: white; cursor: pointer; font-size: 1.1rem; font-weight: bold; }
    tr:nth-child(even) { background: #f2f2f2; }
  </style>
</head>
<body>
  <header>
    <img src="logo.png" alt="Logo">
    <h1><i class="bi bi-graph-up"></i> Demo Stock Sales Tracker</h1>
  </header>

  <div class="form-container">
    <form id="salesForm">
      <label>Date Sold: <input type="date" name="dateSold" required></label>
      <label>Order Number: <input type="text" name="orderNumber" required></label>
      <label>Item Name: <input type="text" name="itemName" required></label>
      <label>Quantity: <input type="number" name="quantity" id="quantity" required></label>
      <label>Unit Price: <input type="number" step="0.01" name="price" id="price" required></label>
      <label>Total Price: <input type="text" id="totalPrice" disabled></label>
      <label>Sold By: <input type="text" name="soldBy"></label>
      <label>Platform: <input type="text" name="platform"></label>
      <label>Customer Name: <input type="text" name="customerName"></label>
      <label>Contact: <input type="text" name="contact"></label>
      <label>Payment Method: <input type="text" name="paymentMethod"></label>
      <label>Notes: <input type="text" name="notes"></label>
      <button class="submit-btn" type="submit">Add Sale</button>
    </form>
  </div>

  <div class="filter-container">
    <label>From: <input type="date" id="fromDate"></label>
    <label>To: <input type="date" id="toDate"></label>
    <button class="download-btn" onclick="downloadExcel()">Download Excel</button>
  </div>

  <div class="responsive-table-wrapper">
    <table id="salesTable">
      <thead>
        <tr>
          <th data-key="dateSold">Date</th>
          <th data-key="orderNumber">Order</th>
          <th data-key="itemName">Item</th>
          <th data-key="quantity">Qty</th>
          <th data-key="price">Unit Price</th>
          <th>Total</th>
          <th>Sold By</th>
          <th>Platform</th>
          <th>Customer</th>
          <th>Contact</th>
          <th>Payment</th>
          <th>Notes</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>
    <div class="total-sales" id="totalDisplay"></div>
  </div>

  <div class="recycle-bin-container">
    <h3>Recycle Bin</h3>
    <div id="recycleBinList"></div>
  </div>

   <script>
   const SALES_KEY = 'salesData';
const BIN_KEY = 'recycleBinData';
let salesData = [];
let recycleBinData = [];
let sortState = { key: 'dateSold', asc: true };

const salesTableBody = document.querySelector('#salesTable tbody');
const recycleBinList = document.getElementById('recycleBinList');
const totalDisplay = document.getElementById('totalDisplay');

function saveToLocalStorage() {
  localStorage.setItem(SALES_KEY, JSON.stringify(salesData));
  localStorage.setItem(BIN_KEY, JSON.stringify(recycleBinData));
}

function loadFromLocalStorage() {
  salesData = JSON.parse(localStorage.getItem(SALES_KEY) || '[]');
  recycleBinData = JSON.parse(localStorage.getItem(BIN_KEY) || '[]');
}

function updateTotal() {
  const price = parseFloat(document.getElementById('price').value);
  const quantity = parseInt(document.getElementById('quantity').value);
  const total = (!isNaN(price) && !isNaN(quantity)) ? (price * quantity).toFixed(2) : '';
  document.getElementById('totalPrice').value = total;
}

document.getElementById('price').addEventListener('input', updateTotal);
document.getElementById('quantity').addEventListener('input', updateTotal);

document.getElementById('salesForm').addEventListener('submit', e => {
  e.preventDefault();
  const form = e.target;
  const quantity = Number(form.quantity.value);
  const price = Number(form.price.value);
  const sale = {
    dateSold: form.dateSold.value,
    orderNumber: form.orderNumber.value.trim(),
    itemName: form.itemName.value.trim(),
    quantity,
    price,
    totalPrice: quantity * price,
    soldBy: form.soldBy.value.trim(),
    platform: form.platform.value.trim(),
    customerName: form.customerName.value.trim(),
    contact: form.contact.value.trim(),
    paymentMethod: form.paymentMethod.value.trim(),
    notes: form.notes.value.trim()
  };
  salesData.push(sale);
  saveToLocalStorage();
  loadData();
  form.reset();
  updateTotal();
});

function renderSalesTable() {
  salesTableBody.innerHTML = '';
  let filtered = [...salesData];
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;

  if (from) filtered = filtered.filter(i => i.dateSold >= from);
  if (to) filtered = filtered.filter(i => i.dateSold <= to);

  filtered.sort((a, b) => {
    let valA = a[sortState.key], valB = b[sortState.key];
    if (["price", "quantity"].includes(sortState.key)) {
      valA = Number(valA); valB = Number(valB);
    }
    return sortState.asc ? (valA > valB ? 1 : -1) : (valA < valB ? 1 : -1);
  });

  filtered.forEach((item, index) => {
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item.dateSold}</td>
      <td>${item.orderNumber}</td>
      <td>${item.itemName}</td>
      <td>${item.quantity}</td>
      <td>R${item.price.toFixed(2)}</td>
      <td>R${item.totalPrice.toFixed(2)}</td>
      <td>${item.soldBy}</td>
      <td>${item.platform}</td>
      <td>${item.customerName}</td>
      <td>${item.contact}</td>
      <td>${item.paymentMethod}</td>
      <td>${item.notes}</td>
      <td><button onclick="deleteSale(${index})">Delete</button></td>`;
    salesTableBody.appendChild(tr);
  });
}

function renderRecycleBin() {
  recycleBinList.innerHTML = recycleBinData.length === 0 ? 'Recycle bin is empty.' : '';
  recycleBinData.forEach((item, index) => {
    const div = document.createElement('div');
    div.innerHTML = `${item.dateSold} - ${item.itemName} - R${item.totalPrice.toFixed(2)} `;
    const restoreBtn = document.createElement('button');
    restoreBtn.textContent = 'Restore';
    restoreBtn.onclick = () => restoreSale(index);
    const deleteBtn = document.createElement('button');
    deleteBtn.textContent = 'Delete';
    deleteBtn.style.backgroundColor = '#c0392b';
    deleteBtn.onclick = () => deleteRecycleBinSale(index);
    div.appendChild(restoreBtn);
    div.appendChild(deleteBtn);
    recycleBinList.appendChild(div);
  });
}

function calculateTotal() {
  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;
  const total = salesData.reduce((sum, item) => {
    if ((!from || item.dateSold >= from) && (!to || item.dateSold <= to)) {
      return sum + Number(item.totalPrice);
    }
    return sum;
  }, 0);
  totalDisplay.textContent = `Total Sales (ZAR): R${total.toFixed(2)}`;
}

function deleteSale(index) {
  if (!confirm("Are you sure you want to delete this sale?")) return;
  recycleBinData.push(salesData.splice(index, 1)[0]);
  saveToLocalStorage();
  loadData();
}

function restoreSale(index) {
  salesData.push(recycleBinData.splice(index, 1)[0]);
  saveToLocalStorage();
  loadData();
}

function deleteRecycleBinSale(index) {
  if (confirm("Permanently delete this record?")) {
    recycleBinData.splice(index, 1);
    saveToLocalStorage();
    loadData();
  }
}

function downloadExcel() {
  const fileName = prompt("Enter a file name for the Excel file:", `Sales_Report_${new Date().toISOString().slice(0,10)}`);
  if (!fileName) return;

  const from = document.getElementById('fromDate').value;
  const to = document.getElementById('toDate').value;
  const filtered = salesData.filter(item =>
    (!from || item.dateSold >= from) && (!to || item.dateSold <= to)
  );

  const worksheet = XLSX.utils.json_to_sheet(filtered);

  // Apply basic styling
  const range = XLSX.utils.decode_range(worksheet['!ref']);
  for (let R = range.s.r; R <= range.e.r; ++R) {
    for (let C = range.s.c; C <= range.e.c; ++C) {
      const cell_address = XLSX.utils.encode_cell({r:R, c:C});
      if (!worksheet[cell_address]) continue;
      worksheet[cell_address].s = {
        border: {
          top: {style: "thin"},
          bottom: {style: "thin"},
          left: {style: "thin"},
          right: {style: "thin"}
        },
        font: R === 0 ? {bold: true, sz: 14} : {sz: 12}
      };
    }
  }

  const workbook = XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(workbook, worksheet, "Sales");
  XLSX.writeFile(workbook, `${fileName}.xlsx`);
}

document.querySelectorAll('#salesTable th[data-key]').forEach(th => {
  th.addEventListener('click', () => {
    const key = th.getAttribute('data-key');
    if (sortState.key === key) sortState.asc = !sortState.asc;
    else { sortState.key = key; sortState.asc = true; }
    document.querySelectorAll('#salesTable th[data-key]').forEach(header =>
      header.textContent = header.textContent.replace(/[\u25B2\u25BC]/g, ''));
    th.textContent += sortState.asc ? ' â–¼' : ' â–²';
    renderSalesTable();
  });
});

document.getElementById('fromDate').addEventListener('change', () => {
  renderSalesTable();
  calculateTotal();
});

document.getElementById('toDate').addEventListener('change', () => {
  renderSalesTable();
  calculateTotal();
});

function loadData() {
  loadFromLocalStorage();
  renderSalesTable();
  renderRecycleBin();
  calculateTotal();
}

loadData()
     if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('service-worker.js')
        .then(() => console.log('Service Worker Registered'))
        .catch(err => console.error('Service Worker registration failed:', err));
    }
  </script>
</body>
</html>
